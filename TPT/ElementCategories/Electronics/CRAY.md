---
title: CRAY
description: 
published: true
date: 2026-01-26T07:40:26.760Z
tags: 
editor: markdown
dateCreated: 2026-01-26T07:40:26.760Z
---

# CRAY 
  
## 基本属性  
  
CRAY是一种物质射线发射器，具有以下基本特征：  
  
- **元素类型**: 固体 (TYPE_SOLID)  
- **颜色**: 亮绿色 (0xBBFF00_rgb)  
- **重量**: 100 (最重级别)  
- **硬度**: 1 (可熔化)  
- **热导率**: 0 (不导热)  
- **菜单分类**: SC_ELEC (电子类)  
- **描述**: 物质射线发射器,发射一个由其Ctype设置的粒子束,其范围由Tmp设置  
- **属性**: 携带类型信息 (CarriesTypeIn = 1U << FIELD_CTYPE)  
  
## 核心工作机制  
  
CRAY的工作原理基于两个主要阶段：ctype设置和粒子发射。  
  
### Ctype自动设置  
当CRAY没有有效的ctype时，会自动检测周围粒子：  
- 扫描周围3x3区域  
- 优先检测photons层，然后是普通粒子层  
- 排除CRAY、PSCN、INST、METL、SPRK等特殊元素  
- 设置第一个找到的有效元素类型为ctype  
- 同时复制该粒子的温度信息  
  
### 粒子发射机制  
当CRAY接收到SPRK信号时触发发射：  
- 检测周围8个方向的SPRK粒子  
- 根据SPRK的ctype决定行为模式：  
  - PSCN: 销毁模式  
  - INST: 穿透模式  
  - INWR: 火花创建模式  
  - 其他: 普通发射模式  
  
## 参数控制系统  
  
CRAY使用tmp和tmp2字段控制发射行为：  
  
### 射程控制 (tmp)  
- 默认值：255粒子  
- 可通过tmp字段自定义射程  
- 每发射一个粒子，剩余数量减1  
- 耗尽后停止发射  
  
### 间距控制 (tmp2)  
- 控制发射起始位置的距离  
- 影响射线的起始偏移量  
- 用于精确控制射线发射点  
  
## 特殊交互机制  
  
### FILT颜色过滤  
CRAY射线可以通过FILT进行颜色过滤：  
- 检测路径上的FILT粒子  
- 根据FILT的tmp值应用不同过滤模式  
- 当FILT.tmp=0时，使用波长到装饰色的转换  
- 过滤后的颜色存储在colored变量中  
- 后续发射的粒子会继承这个颜色  
  
### 销毁模式  
当SPRK.ctype为PSCN时：  
- CRAY进入销毁模式  
- 射线路径上的非DMND粒子会被销毁  
- 每销毁一个粒子消耗一个发射配额  
  
### 穿透模式  
当SPRK.ctype为INST时：  
- CRAY进入穿透模式  
- 射线可以穿过CRAY粒子而不停止  
- 实现无限穿透效果  
  
## 粒子创建与属性继承  
  
### 粒子创建过程  
- 使用sim->create_part()在目标位置创建粒子  
- 粒子类型来自CRAY的ctype  
- 粒子ID来自ctype的ID部分  
- 创建失败时跳过该位置  
  
### 属性继承机制  
- 温度：继承CRAY的温度  
- 生命值：如果CRAY有life>0，会传递给新粒子  
- 颜色：如果通过FILT过滤，会继承装饰色  
- 类型：完全复制ctype的类型和ID信息  
  
## 墙体阻挡检测  
  
CRAY发射前会进行墙体检测：  
- 使用sim->IsWallBlocking()函数  
- 检查目标位置是否阻挡指定粒子类型  
- 只有非阻挡位置才能创建粒子  
- 确保射线不会穿透墙体  
  
## 调试信息显示  
  
在调试模式下，CRAY会显示详细信息：  
- 显示ctype的完整信息 (TYP和ID)  
- 格式：CRAY (元素类型 ID)  
- 帮助用户了解当前配置的发射粒子  
  
## 应用场景与设计理念  
  
CRAY在游戏中扮演以下角色：  
  
1. **粒子发射器**: 创建定向粒子束  
2. **信号传输**: 通过SPRK控制发射时机  
3. **颜色控制**: 配合FILT实现彩色射线  
4. **材料传输**: 远距离传递特定粒子  
5. **逻辑控制**: 作为电子系统的一部分  
  
这种设计使CRAY成为一个功能强大的粒子控制工具，既可用于简单的粒子发射，也可构建复杂的粒子传输系统。